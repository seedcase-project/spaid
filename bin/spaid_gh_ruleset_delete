#!/bin/zsh

help_text="
Usage: `basename $0` [-h]

Delete a specific ruleset.

Examples:

    spaid_gh_ruleset_delete seedcase-project/team 1234

Positional argument:

- repo spec: The GitHub repository spec, in the format of 'owner/repo'.
- ruleset_id: The ID of the ruleset to list.
"

if [[ "$1" == "-h" ]] ; then
  echo $help_text
  exit 0
fi

repo_spec="$1"
ruleset_id="$2"

if [[ "$repo_spec" == "" ]] ; then
  echo "Error: No repo spec has been given. Please provide one."
  exit 1
fi

if [[ "$ruleset_id" == "" ]] ; then
  echo "Error: No ruleset ID has been given. Please provide one."
  exit 1
fi

delete_ruleset() {
  curl -L \
    -X DELETE \
    -H "Accept: application/vnd.github+json" \
    -H "Authorization: Bearer $(gh auth token)" \
    -H "X-GitHub-Api-Version: 2022-11-28" \
    https://api.github.com/repos/$1/rulesets/$2
}

delete_ruleset $repo_spec $ruleset_id
